<view class="container {{showKeyboard ? 'keyboard-active' : ''}}">
  <!-- æœç´¢æ¡† -->
  <view class="search-header">
    <view class="search-box">
      <view class="search-input">
        <text class="search-icon">ğŸ”</text>
        <input 
          class="search-input-field" 
          placeholder="æœç´¢è§†é¢‘/ç”¨æˆ·" 
          value="{{keyword}}"
          bindinput="onInput"
          bindfocus="onInputFocus"
          bindblur="onInputBlur"
          confirm-type="search"
          bindconfirm="onSearch"
          focus="{{inputFocus}}"
        />
      </view>
      <view class="search-btn" bindtap="onSearchBtnTap">æœç´¢</view>
    </view>
  </view>

  <!-- å®æ—¶æœç´¢æ¨è -->
  <view class="matching-section" wx:if="{{matchingWords.length && keyword}}">
    <view class="section-title">æœç´¢æ¨è</view>
    <view class="matching-list">
      <block wx:for="{{matchingWords}}" wx:key="content">
        <view class="matching-item" bindtap="useMatchingWord" data-content="{{item.content}}">
          <text class="matching-text">{{item.content}}</text>
          <view wx:if="{{item.type === 2}}" class="matching-tag hot">çƒ­</view>
          <view wx:elif="{{item.type === 1}}" class="matching-tag new">æ–°</view>
        </view>
      </block>
    </view>
  </view>

  <!-- æœç´¢å»ºè®® -->
  <view class="suggest-section" wx:if="{{suggest.length && !keyword}}">
    <view class="section-title">çŒœä½ æƒ³æœ</view>
    <view class="suggest-list">
      <block wx:for="{{suggest}}" wx:key="*this">
        <view class="suggest-item" bindtap="useSuggest" data-text="{{item}}">{{item}}</view>
      </block>
    </view>
  </view>

  <!-- çƒ­æœæ¦œå• -->
  <view class="hot-search-section" wx:if="{{!searchKeyword && !showKeyboard && hotSearches.length}}">
    <view class="section-header">
      <text class="section-title">bilibiliçƒ­æœ</text>
      <text class="more-link">å®Œæ•´æ¦œå• ></text>
    </view>
    <view class="hot-list">
      <block wx:for="{{hotSearches}}" wx:key="index">
        <view class="hot-item {{index < 5 ? 'left-column' : 'right-column'}}" bindtap="useHotSearch" data-keyword="{{item.keyword}}">
          <view class="hot-rank">{{index + 1}}</view>
          <view class="hot-text">{{item.keyword}}</view>
          <view class="hot-tag" wx:if="{{item.tag}}">{{item.tag}}</view>
        </view>
      </block>
    </view>
  </view>

  <!-- æœç´¢å†å² -->
  <view class="search-history-section" wx:if="{{!searchKeyword && !showKeyboard && searchHistory.length}}">
    <view class="section-header">
      <text class="section-title">æœç´¢å†å²</text>
      <view class="history-actions">
        <text class="action-icon" bindtap="clearAllHistory">æ¸…ç©º</text>
      </view>
    </view>
    <view class="history-list">
      <block wx:for="{{searchHistory}}" wx:key="index">
        <view class="history-item" bindtap="useHistorySearch" data-keyword="{{item.keyword}}">
          <text class="history-text">{{item.keyword}}</text>
          <text class="history-time" wx:if="{{item.time}}">{{item.time}}</text>
          <text class="history-delete" bindtap="removeHistory" data-index="{{index}}" catchtap="true">Ã—</text>
        </view>
      </block>
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view class="search-results" wx:if="{{searchKeyword}}">
    <!-- æœç´¢ç±»å‹æ ‡ç­¾é¡µ -->
    <view class="search-tabs">
      <view class="tab-item {{activeTab === 'video' ? 'active' : ''}}" bindtap="switchTab" data-tab="video">
        è§†é¢‘ {{videos.length}}
      </view>
      <view class="tab-item {{activeTab === 'user' ? 'active' : ''}}" bindtap="switchTab" data-tab="user">
        ç”¨æˆ· {{users.length}}
      </view>
    </view>
    
    <!-- è§†é¢‘æœç´¢ç»“æœ -->
    <view class="tab-content" wx:if="{{activeTab === 'video'}}">
      <view class="video-grid" wx:if="{{videos.length}}">
        <block wx:for="{{videos}}" wx:key="vid">
          <view class="video-item" bindtap="goDetail" data-vid="{{item.video.vid}}">
            <image class="video-cover" src="{{item.video.coverUrl}}" mode="aspectFill" />
            <view class="video-title text-ellipsis">{{item.video.title}}</view>
            <view class="video-meta">
              <text class="play-count">{{formatNum(item.stats.play || item.video.play_count || item.video.playCount || 0)}} æ’­æ”¾</text>
              <text class="danmu-count">{{formatNum(item.stats.danmu || item.video.danmu_count || item.video.danmuCount || 0)}} å¼¹å¹•</text>
            </view>
          </view>
        </block>
      </view>
      
      <!-- è§†é¢‘åŠ è½½çŠ¶æ€ -->
      <view wx:if="{{loading && activeTab === 'video'}}" class="loading-more">åŠ è½½ä¸­...</view>
      <view wx:if="{{!hasMore && videos.length > 0 && activeTab === 'video'}}" class="no-more">æ²¡æœ‰æ›´å¤šäº†</view>
      <view wx:if="{{!loading && videos.length === 0 && activeTab === 'video'}}" class="no-results">
        <text class="no-results-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³è§†é¢‘</text>
      </view>
    </view>
    
    <!-- ç”¨æˆ·æœç´¢ç»“æœ -->
    <view class="tab-content" wx:if="{{activeTab === 'user'}}">
      <view class="user-list" wx:if="{{users.length}}">
        <block wx:for="{{users}}" wx:key="uid">
          <view class="user-item" bindtap="goUserSpace" data-uid="{{item.uid}}">
            <image class="user-avatar" src="{{item.avatar || item.avatar_url || ''}}" mode="aspectFill" />
            <view class="user-info">
              <view class="user-name-row">
                <text class="user-name">{{item.nickname || item.name || 'ç”¨æˆ·'}}</text>
                <view class="user-level">LV{{item.level || 0}}</view>
              </view>
              <view class="user-desc">{{item.description || item.desc || '0ç²‰ä¸Â·0ä¸ªè§†é¢‘'}}</view>
            </view>
            <view class="follow-btn" bindtap="followUser" data-uid="{{item.uid}}" catchtap="true">
              <text class="follow-icon">+</text>
              <text class="follow-text">å…³æ³¨</text>
            </view>
          </view>
        </block>
      </view>
      
      <!-- ç”¨æˆ·åŠ è½½çŠ¶æ€ -->
      <view wx:if="{{loading && activeTab === 'user'}}" class="loading-more">åŠ è½½ä¸­...</view>
      <view wx:if="{{!hasMore && users.length > 0 && activeTab === 'user'}}" class="no-more">æ²¡æœ‰æ›´å¤šäº†</view>
      <view wx:if="{{!loading && users.length === 0 && activeTab === 'user'}}" class="no-results">
        <text class="no-results-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç”¨æˆ·</text>
      </view>
    </view>
  </view>

  <!-- åé¦ˆæŒ‰é’® -->
  <view class="feedback-btn" bindtap="showFeedback">
    <text class="feedback-icon">?</text>
    <text class="feedback-text">åé¦ˆ</text>
  </view>
</view>

