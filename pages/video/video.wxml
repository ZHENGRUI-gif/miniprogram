<view class="container">
  <!-- 播放器 -->
  <video 
    id="player" 
    src="{{playUrl}}" 
    controls 
    autoplay 
    bindtimeupdate="onTimeUpdate" 
    binderror="onVideoError"
    bindloadstart="onVideoLoadStart"
    bindloadeddata="onVideoLoadedData"
    class="player"
  ></video>
  
  <!-- 视频加载错误提示 -->
  <view class="video-error-overlay" wx:if="{{videoLoadError}}">
    <view class="error-content">
      <text class="error-icon">⚠️</text>
      <text class="error-text">视频加载失败</text>
      <text class="error-tip">请检查网络连接或稍后重试</text>
      <button class="retry-btn" bindtap="retryVideo">重新加载</button>
    </view>
  </view>

  <!-- 标题与基础信息 -->
  <view class="card v-info">
    <view class="v-title">{{video.video.title}}</view>
    <view class="v-meta">
      <text class="m">{{video.video.category || '视频'}}</text>
      <text class="dot">·</text>
      <text class="m">{{formatNum(video.stats.play)}} 次观看</text>
      <text class="dot">·</text>
      <text class="m">弹幕 {{formatNum(video.stats.danmu)}}</text>
    </view>
  </view>

  <!-- UP 主信息区 -->
  <view class="card up" wx:if="{{uploader}}" bindtap="goAuthor" data-uid="{{uploader.uid}}">
    <view class="left">
      <image wx:if="{{uploader.avatar}}" class="up-avatar" src="{{uploader.avatar}}" mode="aspectFill" />
      <view wx:else class="up-avatar placeholder">🙂</view>
      <view class="up-info">
        <view class="up-name text-ellipsis">{{uploader.name || 'UP主'}}</view>
        <view class="up-desc text-ellipsis" wx:if="{{uploader.desc}}">{{uploader.desc}}</view>
      </view>
    </view>
    <view class="right">
      <view class="btn follow">+ 关注</view>
    </view>
  </view>

  <!-- 互动操作区 -->
  <view class="card actions">
    <!-- 点赞组件 -->
    <like-button
      video-id="{{vid}}"
      is-liked="{{video.isLiked || false}}"
      is-disliked="{{video.isDisliked || false}}"
      like-count="{{video.stats.good || 0}}"
      dislike-count="{{video.stats.bad || 0}}"
      bind:likechange="onLikeChange"
    ></like-button>
    
    <view class="act">
      <text class="iconfont icon-toubi"></text>
      <text class="txt">投币</text>
    </view>
    <view class="act">
      <text class="iconfont icon-shoucang1"></text>
      <text class="txt">收藏</text>
    </view>
    <view class="act">
      <text class="iconfont icon-zhuanfa"></text>
      <text class="txt">分享</text>
    </view>
  </view>

  <!-- 弹幕层（示意） -->
  <view class="danmu-box">
    <block wx:for="{{danmus}}" wx:key="id">
      <text class="dm" style="color: {{item.color}}; top: {{item.top}}rpx;">{{item.content}}</text>
    </block>
  </view>

  <!-- 相关推荐 -->
  <view class="card related">
    <view class="section-title">相关推荐</view>
    <view class="r-list">
      <block wx:for="{{related}}" wx:key="vid">
        <view class="r-item" bindtap="goDetail" data-vid="{{item.video.vid}}">
          <image class="r-cover" src="{{item.video.cover_url || item.video.coverUrl}}" mode="aspectFill" />
          <view class="r-title text-ellipsis">{{item.video.title}}</view>
          <view class="r-meta">{{formatNum(item.stats.play)}} · {{formatNum(item.stats.danmu)}}弹幕</view>
        </view>
      </block>
    </view>
  </view>
</view>

