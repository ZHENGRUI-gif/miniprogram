<view class="container">
  <!-- å›ºå®šèŠå¤©æŒ‰é’® -->
  <view class="chat-btn" bindtap="goChat">ğŸ’¬</view>

  <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="profile-section">
    <!-- ç”¨æˆ·å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
    <view class="user-header">
      <view class="avatar-container">
        <image wx:if="{{user.avatar_url}}" class="avatar" src="{{user.avatar_url}}" mode="aspectFill" />
        <view wx:else class="avatar placeholder">ğŸ™‚</view>
        <view wx:if="{{user.level}}" class="level-badge">LV{{user.level}}</view>
      </view>
      
      <view class="user-info">
        <view class="name-row">
          <text class="nickname">{{user.nickname || 'ç”¨æˆ·'}}</text>
          <view wx:if="{{user.auth}}" class="auth-badge">è®¤è¯</view>
          <view wx:if="{{user.vip}}" class="vip-badge">å¤§ä¼šå‘˜</view>
        </view>
        <view class="desc">{{user.signature || 'è¿™ä¸ªäººå¾ˆç¥ç§˜ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰å†™'}}</view>
        <view class="location">IPå±åœ°: {{user.location || 'æœªçŸ¥'}}</view>
      </view>
    </view>

    <!-- ç»Ÿè®¡æ•°æ® -->
    <view class="stats-row">
      <view class="stat-item" bindtap="goFans">
        <text class="stat-number">{{formatNum(user.fansCount || 0)}}</text>
        <text class="stat-label">ç²‰ä¸</text>
      </view>
      <view class="stat-item" bindtap="goFollows">
        <text class="stat-number">{{formatNum(user.followsCount || 0)}}</text>
        <text class="stat-label">å…³æ³¨</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{formatNum(user.loveCount || 0)}}</text>
        <text class="stat-label">è·èµ</text>
      </view>
    </view>

    <!-- å…³æ³¨æŒ‰é’® -->
    <view wx:if="{{!isOwn}}" class="follow-btn {{isFollowing ? 'followed' : ''}}" bindtap="toggleFollow">
      <text class="follow-text">{{isFollowing ? 'å·²å…³æ³¨' : '+ å…³æ³¨'}}</text>
    </view>
  </view>

  <!-- å¯¼èˆªæ ‡ç­¾ -->
  <view class="nav-tabs">
    <view class="tab {{activeTab === 'home' ? 'active' : ''}}" bindtap="switchTab" data-tab="home">ä¸»é¡µ</view>
    <view class="tab {{activeTab === 'videos' ? 'active' : ''}}" bindtap="switchTab" data-tab="videos">æŠ•ç¨¿</view>
    <view class="tab {{activeTab === 'favorites' ? 'active' : ''}}" bindtap="switchTab" data-tab="favorites">æ”¶è—</view>
  </view>

  <!-- è§†é¢‘åˆ—è¡¨åŒºåŸŸ -->
  <view wx:if="{{activeTab === 'videos'}}" class="videos-section">
    <view class="section-header">
      <view class="video-title">
        <text class="title-text">{{isOwn ? 'æˆ‘çš„' : 'TAçš„'}}æŠ•ç¨¿</text>
        <text class="title-count">{{videoCount}}</text>
      </view>
      <view class="sort-tabs">
        <view class="sort-tab {{sortRule === 1 ? 'active' : ''}}" bindtap="changeSortRule" data-rule="1">
          <text>æœ€æ–°å‘å¸ƒ</text>
        </view>
        <view class="sort-tab {{sortRule === 2 ? 'active' : ''}}" bindtap="changeSortRule" data-rule="2">
          <text>æœ€å¤šæ’­æ”¾</text>
        </view>
        <view class="sort-tab {{sortRule === 3 ? 'active' : ''}}" bindtap="changeSortRule" data-rule="3">
          <text>æœ€å¤šç‚¹èµ</text>
        </view>
      </view>
    </view>

    <view wx:if="{{videos.length > 0}}" class="video-list">
      <block wx:for="{{videos}}" wx:key="vid">
        <view class="video-item" bindtap="goDetail" data-vid="{{item.video.vid}}">
          <view class="video-thumbnail">
            <image class="thumbnail" src="{{item.video.cover_url || item.video.coverUrl}}" mode="aspectFill" />
            <view class="duration">{{formatDuration(item.video.duration)}}</view>
          </view>
          <view class="video-info">
            <view class="video-title">{{item.video.title}}</view>
            <view class="video-meta">
              <text class="upload-time">{{formatUploadTime(item.video.uploadDate)}}</text>
            </view>
            <view class="video-stats">
              <view class="stat">
                <text class="stat-icon">â–¶</text>
                <text class="stat-text">{{formatNum(item.stats.play || item.video.play_count || item.video.playCount || 0)}}</text>
              </view>
              <view class="stat">
                <text class="stat-icon">ğŸ’¬</text>
                <text class="stat-text">{{formatNum(item.stats.danmu || item.video.danmu_count || item.video.danmuCount || 0)}}</text>
              </view>
            </view>
          </view>
          <view class="more-btn">â‹®</view>
        </view>
      </block>
    </view>
    <view wx:else class="empty-state">
      <text class="empty-text">æš‚æ— è§†é¢‘</text>
    </view>
    
    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{videos.length > 0 && hasMore}}" class="load-more" bindtap="loadMoreVideos">
      <text class="load-text">{{loadingMore ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}</text>
    </view>
    
    <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
    <view wx:if="{{videos.length > 0 && !hasMore}}" class="no-more">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šè§†é¢‘äº†</text>
    </view>
  </view>

  <!-- ä¸»é¡µå†…å®¹ -->
  <view wx:elif="{{activeTab === 'home'}}" class="home-content">
    <!-- ç”¨æˆ·è§†é¢‘åŒºåŸŸ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">{{isOwn ? 'æˆ‘çš„' : 'TAçš„'}}è§†é¢‘</text>
        <text class="section-count">{{videoCount}}</text>
        <view class="section-more" bindtap="goToVideos">
          <text class="more-text">æ›´å¤š</text>
          <text class="more-icon">></text>
        </view>
      </view>
      
      <view wx:if="{{homeVideos.length > 0}}" class="video-grid">
        <block wx:for="{{homeVideos}}" wx:key="vid">
          <view class="video-card" bindtap="goDetail" data-vid="{{item.video.vid}}">
            <view class="video-cover">
              <image class="cover-img" src="{{item.video.cover_url || item.video.coverUrl}}" mode="aspectFill" />
              <view class="duration">{{formatDuration(item.video.duration)}}</view>
            </view>
            <view class="video-title">{{item.video.title}}</view>
            <view class="video-stats">
              <text class="play-count">{{formatNum(item.stats.play || item.video.play_count || 0)}}æ’­æ”¾</text>
              <text class="upload-time">{{formatUploadTime(item.video.uploadDate)}}</text>
            </view>
          </view>
        </block>
      </view>
      <view wx:else class="empty-videos">
        <text class="empty-text">æš‚æ— è§†é¢‘</text>
      </view>
    </view>

    <!-- æ”¶è—å¤¹åŒºåŸŸ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">{{isOwn ? 'æˆ‘çš„' : 'TAçš„'}}æ”¶è—å¤¹</text>
        <text class="section-count">{{favList.length}}</text>
        <view class="section-more" bindtap="goToFavorites">
          <text class="more-text">æ›´å¤š</text>
          <text class="more-icon">></text>
        </view>
      </view>
      
      <view wx:if="{{favList.length > 0}}" class="fav-grid">
        <block wx:for="{{favList}}" wx:key="fid">
          <view class="fav-card" bindtap="goToFavDetail" data-fid="{{item.fid}}">
            <view class="fav-cover">
              <image wx:if="{{item.cover}}" class="cover-img" src="{{item.cover}}" mode="aspectFill" />
              <view wx:else class="cover-placeholder">ğŸ“</view>
              <view class="fav-count">{{item.count}}</view>
            </view>
            <view class="fav-title">{{item.title}}</view>
            <view class="fav-meta">
              <text class="fav-visibility">{{item.visible === 1 ? 'å…¬å¼€' : 'ç§å¯†'}}</text>
            </view>
          </view>
        </block>
      </view>
      <view wx:else class="empty-favs">
        <text class="empty-text">æš‚æ— æ”¶è—å¤¹</text>
      </view>
    </view>

    <!-- æœ€è¿‘ç‚¹èµåŒºåŸŸ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">æœ€è¿‘ç‚¹èµçš„è§†é¢‘</text>
      </view>
      
      <view wx:if="{{loveVideos.length > 0}}" class="love-list">
        <block wx:for="{{loveVideos}}" wx:key="vid">
          <view class="love-item" bindtap="goDetail" data-vid="{{item.video.vid}}">
            <view class="love-cover">
              <image class="cover-img" src="{{item.video.cover_url || item.video.coverUrl}}" mode="aspectFill" />
              <view class="duration">{{formatDuration(item.video.duration)}}</view>
            </view>
            <view class="love-info">
              <view class="love-title">{{item.video.title}}</view>
              <view class="love-meta">
                <text class="author">{{item.user.nickname}}</text>
                <text class="play-count">{{formatNum(item.stats.play || 0)}}æ’­æ”¾</text>
              </view>
            </view>
          </view>
        </block>
      </view>
      <view wx:else class="empty-love">
        <text class="empty-text">æš‚æ— ç‚¹èµè®°å½•</text>
      </view>
    </view>
  </view>

  <!-- æ”¶è—å†…å®¹ -->
  <view wx:else class="favorites-content">
    <view wx:if="{{favList.length > 0}}" class="fav-list">
      <block wx:for="{{favList}}" wx:key="fid">
        <view class="fav-item" bindtap="goToFavDetail" data-fid="{{item.fid}}">
          <view class="fav-cover">
            <image wx:if="{{item.cover}}" class="cover-img" src="{{item.cover}}" mode="aspectFill" />
            <view wx:else class="cover-placeholder">ğŸ“</view>
            <view class="fav-count">{{item.count}}</view>
          </view>
          <view class="fav-info">
            <view class="fav-title">{{item.title}}</view>
            <view class="fav-desc">{{item.description || 'æš‚æ— æè¿°'}}</view>
            <view class="fav-meta">
              <text class="fav-visibility">{{item.visible === 1 ? 'å…¬å¼€' : 'ç§å¯†'}}</text>
              <text class="fav-time">{{formatUploadTime(item.create_time)}}</text>
            </view>
          </view>
        </view>
      </block>
    </view>
    <view wx:else class="empty-favs">
      <text class="empty-text">æš‚æ— æ”¶è—å¤¹</text>
    </view>
  </view>
</view>