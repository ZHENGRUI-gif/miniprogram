<view class="container">
  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs">
    <view 
      class="tab {{selectedTab === 0 ? 'active' : ''}}"
      bindtap="onTabChange"
      data-tab="0"
    >
      æˆ‘çš„æ”¶è—å¤¹
    </view>
    <view 
      class="tab {{selectedTab === 1 ? 'active' : ''}}"
      bindtap="onTabChange"
      data-tab="1"
    >
      æ”¶è—çš„è§†é¢‘
    </view>
  </view>

  <!-- æˆ‘çš„æ”¶è—å¤¹ -->
  <view wx:if="{{selectedTab === 0}}" class="favorites-tab">
    <!-- åˆ›å»ºæ”¶è—å¤¹æŒ‰é’® -->
    <view class="create-favorite" bindtap="createFavorite">
      <text class="iconfont icon-add"></text>
      <text class="create-text">åˆ›å»ºæ”¶è—å¤¹</text>
    </view>

    <!-- æ”¶è—å¤¹åˆ—è¡¨ -->
    <view class="favorites-list">
      <block wx:for="{{favorites}}" wx:key="fid">
        <view 
          class="favorite-item {{currentFavorite && currentFavorite.fid === item.fid ? 'selected' : ''}}"
          bindtap="onFavoriteSelect"
          data-fid="{{item.fid}}"
        >
          <view class="favorite-cover">
            <image 
              wx:if="{{item.cover}}" 
              class="cover-image" 
              src="{{item.cover}}" 
              mode="aspectFill" 
            />
            <view wx:else class="cover-placeholder">
              <text class="iconfont icon-folder"></text>
            </view>
            <view class="video-count-badge">{{item.count}}</view>
          </view>
          <view class="favorite-info">
            <view class="favorite-title">{{item.title}}</view>
            <view class="favorite-desc">{{item.description || 'æš‚æ— æè¿°'}}</view>
            <view class="favorite-meta">
              <text class="visibility">{{item.visible === 1 ? 'å…¬å¼€' : 'ç§å¯†'}}</text>
            </view>
          </view>
          <view class="favorite-arrow">
            <text class="iconfont icon-arrow-right"></text>
          </view>
        </view>
      </block>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{favorites.length === 0 && !loading}}" class="empty-state">
      <view class="empty-icon">ğŸ“</view>
      <text class="empty-text">è¿˜æ²¡æœ‰æ”¶è—å¤¹</text>
      <text class="empty-tip">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»ºç¬¬ä¸€ä¸ªæ”¶è—å¤¹</text>
    </view>
  </view>

  <!-- æ”¶è—çš„è§†é¢‘ -->
  <view wx:if="{{selectedTab === 1}}" class="videos-tab">
    <!-- æ”¶è—å¤¹é€‰æ‹©å™¨ -->
    <view wx:if="{{favorites.length > 0}}" class="favorite-selector">
      <view class="selector-label">é€‰æ‹©æ”¶è—å¤¹ï¼š</view>
      <view class="selector-list">
        <block wx:for="{{favorites}}" wx:key="fid">
          <view 
            class="selector-item {{currentFavorite && currentFavorite.fid === item.fid ? 'selected' : ''}}"
            bindtap="onFavoriteSelect"
            data-fid="{{item.fid}}"
          >
            {{item.title}}
          </view>
        </block>
      </view>
    </view>

    <!-- è§†é¢‘åˆ—è¡¨ -->
    <view class="video-list">
      <view wx:if="{{collectedVideos.length > 0}}">
        <block wx:for="{{collectedVideos}}" wx:key="vid">
          <view class="video-item" bindtap="goToVideo" data-vid="{{item.video.vid}}">
            <view class="video-thumbnail">
              <image class="thumbnail" src="{{item.video.cover_url || item.video.coverUrl}}" mode="aspectFill" />
              <view class="duration">{{formatDuration(item.video.duration)}}</view>
            </view>
            <view class="video-info">
              <view class="video-title">{{item.video.title}}</view>
              <view class="video-meta">
                <text class="author">{{item.user.nickname || 'æœªçŸ¥ç”¨æˆ·'}}</text>
                <text class="upload-time">{{formatUploadTime(item.video.uploadDate)}}</text>
              </view>
              <view class="video-stats">
                <view class="stat">
                  <text class="stat-icon">â–¶</text>
                  <text class="stat-text">{{formatNum(item.stats.play || item.video.play_count || item.video.playCount || 0)}}</text>
                </view>
                <view class="stat">
                  <text class="stat-icon">ğŸ’¬</text>
                  <text class="stat-text">{{formatNum(item.stats.danmu || item.video.danmu_count || item.video.danmuCount || 0)}}</text>
                </view>
                <view class="stat">
                  <text class="stat-icon">ğŸ‘</text>
                  <text class="stat-text">{{formatNum(item.stats.good || item.video.like_count || item.video.likeCount || 0)}}</text>
                </view>
              </view>
            </view>
          </view>
        </block>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view wx:else class="empty-state">
        <view class="empty-icon">ğŸ“¹</view>
        <text class="empty-text">è¯¥æ”¶è—å¤¹æš‚æ— è§†é¢‘</text>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{collectedVideos.length > 0 && hasMore}}" class="load-more" bindtap="loadMoreVideos">
      <text class="load-text">{{loadingMore ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}</text>
    </view>
    
    <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
    <view wx:if="{{collectedVideos.length > 0 && !hasMore}}" class="no-more">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šè§†é¢‘äº†</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
