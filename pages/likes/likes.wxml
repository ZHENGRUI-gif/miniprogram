<view class="container">
  <!-- å¤´éƒ¨æ“ä½œæ  -->
  <view class="header">
    <view class="title">æ”¶åˆ°çš„èµ</view>
    <view class="organize-btn" bindtap="toggleOrganize">
      <text class="btn-text">{{isOrganized ? 'æ™®é€šæ¨¡å¼' : 'æ•´ç†æ¨¡å¼'}}</text>
    </view>
  </view>

  <!-- æ™®é€šæ¨¡å¼ï¼šæ˜¾ç¤ºæ‰€æœ‰ç‚¹èµè®°å½• -->
  <view wx:if="{{!isOrganized}}" class="like-list">
    <block wx:for="{{likeList}}" wx:key="index">
      <view class="like-item" bindtap="openVideo" data-vid="{{item.video.vid}}">
        <view class="user-info">
          <image 
            wx:if="{{item.user.avatar_url}}" 
            class="user-avatar" 
            src="{{item.user.avatar_url}}" 
            mode="aspectFill" 
          />
          <view wx:else class="user-avatar placeholder">ğŸ‘¤</view>
          <view class="user-details">
            <view class="user-name">{{item.user.nickname || 'ç”¨æˆ·' + item.user.uid}}</view>
            <view class="like-time">{{item.formattedTime}}</view>
          </view>
        </view>
        
        <view class="video-info">
          <image class="video-cover" src="{{item.video.coverUrl || item.video.cover_url}}" mode="aspectFill" />
          <view class="video-details">
            <view class="video-title text-ellipsis">{{item.video.title}}</view>
            <view class="video-stats">
              <text class="stat">â–¶ {{formatNum(item.stats.play)}}</text>
              <text class="stat">ğŸ‘ {{formatNum(item.stats.good)}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
    
    <view wx:elif="{{!hasMore && likeList.length > 0}}" class="no-more">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
    
    <view wx:elif="{{likeList.length === 0 && !loading}}" class="empty">
      <text class="empty-text">æš‚æ— æ”¶åˆ°çš„èµ</text>
    </view>
  </view>

  <!-- æ•´ç†æ¨¡å¼ï¼šæŒ‰è§†é¢‘åˆ†ç»„æ˜¾ç¤º -->
  <view wx:else class="grouped-list">
    <block wx:for="{{groupedLikes}}" wx:key="videoId" wx:for-item="group" wx:for-index="videoId">
      <view class="group-item">
        <!-- è§†é¢‘ä¿¡æ¯å¤´éƒ¨ -->
        <view class="group-header" bindtap="toggleGroup" data-video-id="{{videoId}}">
          <view class="video-summary">
            <image class="group-cover" src="{{group.video.coverUrl || group.video.cover_url}}" mode="aspectFill" />
            <view class="group-info">
              <view class="group-title text-ellipsis">{{group.video.title}}</view>
              <view class="group-stats">
                <text class="stat">â–¶ {{formatNum(group.stats.play)}}</text>
                <text class="stat">ğŸ‘ {{formatNum(group.stats.good)}}</text>
                <text class="stat">æ”¶åˆ° {{group.likes.length}} ä¸ªèµ</text>
              </view>
            </view>
          </view>
          <view class="expand-icon {{expandedGroups[videoId] ? 'expanded' : ''}}">â–¼</view>
        </view>
        
        <!-- ç‚¹èµç”¨æˆ·åˆ—è¡¨ -->
        <view wx:if="{{expandedGroups[videoId]}}" class="likes-detail">
          <block wx:for="{{group.likes}}" wx:key="index" wx:for-item="like">
            <view class="like-user" bindtap="openUserSpace" data-uid="{{like.user.uid}}">
              <image 
                wx:if="{{like.user.avatar_url}}" 
                class="like-avatar" 
                src="{{like.user.avatar_url}}" 
                mode="aspectFill" 
              />
              <view wx:else class="like-avatar placeholder">ğŸ‘¤</view>
              <view class="like-user-info">
                <view class="like-user-name">{{like.user.nickname || 'ç”¨æˆ·' + like.user.uid}}</view>
                <view class="like-user-time">{{like.formattedTime}}</view>
              </view>
            </view>
          </block>
        </view>
      </view>
    </block>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
    
    <view wx:elif="{{!hasMore && likeList.length > 0}}" class="no-more">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
    
    <view wx:elif="{{likeList.length === 0 && !loading}}" class="empty">
      <text class="empty-text">æš‚æ— æ”¶åˆ°çš„èµ</text>
    </view>
  </view>
</view>
